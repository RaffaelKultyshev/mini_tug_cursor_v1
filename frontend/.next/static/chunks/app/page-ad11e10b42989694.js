(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{3026:function(e,s,a){Promise.resolve().then(a.bind(a,8811))},8811:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return y}});var t=a(7437),l=a(2265),n=a(7648);function r(){return(0,t.jsxs)("div",{className:"w-56 h-screen bg-gray-900 text-white px-4 py-6 flex flex-col gap-4",children:[(0,t.jsx)("h1",{className:"text-xl font-bold",children:"Mini-TUG"}),(0,t.jsx)("nav",{className:"flex flex-col gap-2 text-gray-300",children:(0,t.jsx)(n.default,{className:"hover:text-white",href:"/",children:"Dashboard"})})]})}function c(e){let{label:s,value:a}=e;return(0,t.jsxs)("div",{className:"p-4 rounded-xl border bg-white shadow-sm flex flex-col",children:[(0,t.jsx)("span",{className:"text-gray-500 text-sm",children:s}),(0,t.jsx)("span",{className:"text-2xl font-semibold mt-1",children:a})]})}let i=a(257).env.NEXT_PUBLIC_API_URL||"http://127.0.0.1:8000";async function d(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=await fetch("".concat(i).concat(e),{headers:{"Content-Type":"application/json",...s.headers||{}},...s});if(!a.ok)throw Error(await a.text()||"API error ".concat(a.status));return 204===a.status?null:a.json()}function o(e,s){return d(e,{method:"POST",body:s?JSON.stringify(s):void 0})}async function h(e,s){let a=await fetch("".concat(i).concat(e),{method:"POST",body:s});if(!a.ok)throw Error(await a.text()||"Upload failed (".concat(a.status,")"));return a.json()}let x=()=>o("/data/sample"),m=()=>o("/data/reset"),u=(e,s)=>{let a=new FormData;return a.append("file",s),h("/data/upload/".concat(e),a)},p=e=>{let s=new FormData;return e.forEach(e=>s.append("files",e)),h("/ocr/scan",s)},j=e=>o("/reconcile",e),f=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"ALL";return d("/reporting/overview?entity=".concat(encodeURIComponent(e)))},v=()=>d("/reporting/exceptions"),b=()=>d("/reporting/journal"),g="".concat(i,"/reports/board-pack"),N={date_window_days:3,amount_tolerance:.5,psp_fee_abs:50,psp_fee_pct:4,only_psp_names:!0,persist:!1};function y(){let{data:e,loading:s,error:a,refetch:n}=function(){let[e,s]=(0,l.useState)(null),[a,t]=(0,l.useState)(!0),[n,r]=(0,l.useState)(null),c=(0,l.useCallback)(async()=>{try{var e;t(!0),r(null);let a=await (e="/kpi",d(e));s(a)}catch(e){r(e instanceof Error?e.message:"Unknown error")}finally{t(!1)}},[]);return(0,l.useEffect)(()=>{c()},[c]),{data:e,loading:a,error:n,refetch:c}}(),[i,o]=(0,l.useState)(null),[h,y]=(0,l.useState)(null),[w,_]=(0,l.useState)(!0),[k,C]=(0,l.useState)(null),[S,P]=(0,l.useState)("success"),[E,L]=(0,l.useState)("ALL"),[R,A]=(0,l.useState)(N),[U,D]=(0,l.useState)(null),[T,M]=(0,l.useState)([]),[F,I]=(0,l.useState)(!1),O=(e,s)=>{P(e),C(s),setTimeout(()=>C(null),4e3)},G=(0,l.useCallback)(async e=>{try{_(!0);let s=await f(e);o(s)}catch(e){O("error",e instanceof Error?e.message:"Kon overview niet laden")}finally{_(!1)}},[]),B=(0,l.useCallback)(async()=>{try{let e=await v();y(e)}catch(e){O("error",e instanceof Error?e.message:"Kon uitzonderingen niet laden")}},[]);(0,l.useEffect)(()=>{G(E),B()},[E,G,B]);let K=async()=>{try{await x(),O("success","Sample data geladen"),await Promise.all([n(),G(E),B()])}catch(e){O("error",e instanceof Error?e.message:"Sample laden faalde")}},J=async()=>{try{await m(),O("success","Database gereset"),o(null),y(null),await n()}catch(e){O("error",e instanceof Error?e.message:"Reset mislukt")}},V=e=>async s=>{var a;let t=null===(a=s.target.files)||void 0===a?void 0:a[0];if(s.target.value="",t)try{await u(e,t),O("success","".concat(e," ge\xfcpload")),await Promise.all([n(),G(E),B()])}catch(e){O("error",e instanceof Error?e.message:"Upload faalde")}},X=async e=>{let s=e.target.files?Array.from(e.target.files):[];if(e.target.value="",s.length)try{await p(s),O("success","OCR-run succesvol"),await Promise.all([n(),G(E),B()])}catch(e){O("error",e instanceof Error?e.message:"OCR faalde")}},z=async()=>{try{let e=await j(R);D(e.summary),O("success","Reconciliatie uitgevoerd"),await Promise.all([n(),G(E),B()])}catch(e){O("error",e instanceof Error?e.message:"Reconciliatie faalde")}},W=async()=>{try{I(!0);let e=await b();M(e.rows||[])}catch(e){O("error",e instanceof Error?e.message:"Kon journaal niet laden")}finally{I(!1)}},q=(e,s)=>{A(a=>({...a,[e]:s}))};return(0,t.jsxs)("div",{className:"flex",children:[(0,t.jsx)(r,{}),(0,t.jsxs)("main",{className:"flex-1 p-8 bg-gray-50 min-h-screen space-y-8",children:[(0,t.jsxs)("header",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-3xl font-bold",children:"Mini-TUG Control Center"}),(0,t.jsx)("p",{className:"text-gray-500",children:"Webversie van de eerdere Streamlit flow"})]}),(0,t.jsxs)("div",{className:"flex gap-3",children:[(0,t.jsx)("button",{className:"px-4 py-2 bg-gray-900 text-white rounded",onClick:K,children:"Load sample data"}),(0,t.jsx)("button",{className:"px-4 py-2 bg-red-500 text-white rounded",onClick:J,children:"Reset DB"})]})]}),k&&(0,t.jsx)("div",{className:"p-3 rounded ".concat("success"===S?"bg-green-100 text-green-800":"bg-red-100 text-red-700"),children:k}),(0,t.jsxs)("section",{children:[(0,t.jsx)("h2",{className:"text-2xl font-semibold mb-4",children:"KPI Snapshot"}),s&&(0,t.jsx)("p",{children:"Laden..."}),a&&(0,t.jsx)("p",{className:"text-red-500",children:a}),!s&&e&&(0,t.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,t.jsx)(c,{label:"Invoices",value:e.invoices_count}),(0,t.jsx)(c,{label:"Bank TX",value:e.bank_count}),(0,t.jsx)(c,{label:"Total revenue",value:"€".concat(e.total_revenue.toFixed(0))}),(0,t.jsx)(c,{label:"Collection rate",value:"".concat((100*e.collection_rate).toFixed(1),"%")})]})]}),(0,t.jsxs)("section",{className:"bg-white rounded shadow p-6 space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("h2",{className:"text-xl font-semibold",children:"Insight overview"}),(0,t.jsxs)("select",{value:E,onChange:e=>L(e.target.value),className:"border rounded px-3 py-2",children:[(0,t.jsx)("option",{value:"ALL",children:"ALL entities"}),(0,t.jsx)("option",{value:"TUG_NL",children:"TUG_NL"})]})]}),w&&(0,t.jsx)("p",{children:"Data ophalen..."}),!w&&i&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,t.jsx)(c,{label:"Matched #",value:i.kpis.matched_count}),(0,t.jsx)(c,{label:"Matched €",value:"€".concat(i.kpis.matched_amount.toFixed(0))}),(0,t.jsx)(c,{label:"Unmatched €",value:"€".concat(i.kpis.unmatched_amount.toFixed(0))}),(0,t.jsx)(c,{label:"Runway (m)",value:i.kpis.runway_months?i.kpis.runway_months.toFixed(1):"-"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"font-semibold mb-2",children:"Accrued vs collected"}),(0,t.jsx)("div",{className:"overflow-x-auto text-sm",children:(0,t.jsxs)("table",{className:"w-full text-left",children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"py-2",children:"Month"}),(0,t.jsx)("th",{children:"Metric"}),(0,t.jsx)("th",{children:"Amount"})]})}),(0,t.jsx)("tbody",{children:i.rev_vs_collected.map((e,s)=>{var a;return(0,t.jsxs)("tr",{children:[(0,t.jsx)("td",{className:"py-1",children:null===(a=e.month)||void 0===a?void 0:a.slice(0,10)}),(0,t.jsx)("td",{children:e.metric}),(0,t.jsxs)("td",{children:["€",e.amount.toLocaleString()]})]},"".concat(e.metric,"-").concat(s))})})]})})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"font-semibold mb-2",children:"Net revenue & VAT"}),(0,t.jsx)("div",{className:"overflow-x-auto text-sm",children:(0,t.jsxs)("table",{className:"w-full text-left",children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"py-2",children:"Month"}),(0,t.jsx)("th",{children:"Metric"}),(0,t.jsx)("th",{children:"Amount"})]})}),(0,t.jsx)("tbody",{children:i.net_vat.map((e,s)=>{var a;return(0,t.jsxs)("tr",{children:[(0,t.jsx)("td",{className:"py-1",children:null===(a=e.month)||void 0===a?void 0:a.slice(0,10)}),(0,t.jsx)("td",{children:e.metric}),(0,t.jsxs)("td",{children:["€",e.amount.toLocaleString()]})]},"".concat(e.metric,"-").concat(s))})})]})})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"font-semibold mb-2",children:"Top open AR"}),(0,t.jsx)("div",{className:"overflow-x-auto text-sm",children:(0,t.jsxs)("table",{className:"w-full text-left",children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{children:"Date"}),(0,t.jsx)("th",{children:"Partner"}),(0,t.jsx)("th",{children:"Amount"}),(0,t.jsx)("th",{children:"Invoice #"})]})}),(0,t.jsx)("tbody",{children:i.top_ar.map((e,s)=>{var a,l;return(0,t.jsxs)("tr",{children:[(0,t.jsx)("td",{children:null===(a=e.date)||void 0===a?void 0:a.slice(0,10)}),(0,t.jsx)("td",{children:e.partner}),(0,t.jsxs)("td",{children:["€",null===(l=e.amount)||void 0===l?void 0:l.toLocaleString()]}),(0,t.jsx)("td",{children:e.invoice_no})]},"".concat(e.invoice_no,"-").concat(s))})})]})})]})]})]}),(0,t.jsxs)("section",{className:"bg-white rounded shadow p-6 space-y-4",children:[(0,t.jsx)("h2",{className:"text-xl font-semibold",children:"Data management"}),(0,t.jsxs)("div",{className:"grid md:grid-cols-3 gap-4",children:[(0,t.jsxs)("label",{className:"flex flex-col gap-2",children:[(0,t.jsx)("span",{className:"font-medium",children:"Upload invoices CSV"}),(0,t.jsx)("input",{type:"file",accept:".csv",onChange:V("invoices"),className:"border rounded px-3 py-2"})]}),(0,t.jsxs)("label",{className:"flex flex-col gap-2",children:[(0,t.jsx)("span",{className:"font-medium",children:"Upload bank CSV"}),(0,t.jsx)("input",{type:"file",accept:".csv",onChange:V("bank_tx"),className:"border rounded px-3 py-2"})]}),(0,t.jsxs)("label",{className:"flex flex-col gap-2",children:[(0,t.jsx)("span",{className:"font-medium",children:"OCR PDF/JPG/PNG"}),(0,t.jsx)("input",{type:"file",accept:".pdf,.png,.jpg,.jpeg",multiple:!0,onChange:X,className:"border rounded px-3 py-2"})]})]})]}),(0,t.jsxs)("section",{className:"bg-white rounded shadow p-6 space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("h2",{className:"text-xl font-semibold",children:"Reconciliation rules"}),(0,t.jsx)("button",{className:"px-4 py-2 bg-blue-600 text-white rounded",onClick:z,children:"Run reconciliation"})]}),(0,t.jsxs)("div",{className:"grid md:grid-cols-3 gap-4",children:[(0,t.jsxs)("label",{className:"flex flex-col text-sm",children:["Date window (\xb1 days)",(0,t.jsx)("input",{type:"number",min:0,className:"border rounded px-3 py-2",value:R.date_window_days,onChange:e=>q("date_window_days",Number(e.target.value))})]}),(0,t.jsxs)("label",{className:"flex flex-col text-sm",children:["Amount tolerance (€)",(0,t.jsx)("input",{type:"number",step:"0.1",className:"border rounded px-3 py-2",value:R.amount_tolerance,onChange:e=>q("amount_tolerance",Number(e.target.value))})]}),(0,t.jsxs)("label",{className:"flex flex-col text-sm",children:["Max PSP fee (€)",(0,t.jsx)("input",{type:"number",className:"border rounded px-3 py-2",value:R.psp_fee_abs,onChange:e=>q("psp_fee_abs",Number(e.target.value))})]}),(0,t.jsxs)("label",{className:"flex flex-col text-sm",children:["Max PSP fee (%)",(0,t.jsx)("input",{type:"number",step:"0.1",className:"border rounded px-3 py-2",value:R.psp_fee_pct,onChange:e=>q("psp_fee_pct",Number(e.target.value))})]}),(0,t.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,t.jsx)("input",{type:"checkbox",checked:R.only_psp_names,onChange:e=>q("only_psp_names",e.target.checked)}),"Alleen PSP namen filteren"]}),(0,t.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,t.jsx)("input",{type:"checkbox",checked:R.persist,onChange:e=>q("persist",e.target.checked)}),"Schrijf matches terug naar DB"]})]}),U&&(0,t.jsxs)("div",{className:"text-sm bg-gray-50 border rounded p-3",children:[(0,t.jsxs)("p",{children:["Rule1: ",U.total_rule1," \xb7 Rule2: ",U.total_rule2," \xb7 Rule3: ",U.total_rule3]}),(0,t.jsx)("div",{className:"mt-2 space-y-1 max-h-40 overflow-auto",children:U.recent.map((e,s)=>(0,t.jsxs)("p",{children:[e.rule," – ",e.match_id]},"".concat(e.match_id,"-").concat(s)))})]})]}),(0,t.jsxs)("section",{className:"bg-white rounded shadow p-6 space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("h2",{className:"text-xl font-semibold",children:"Exceptions"}),(0,t.jsx)("button",{className:"text-sm underline",onClick:()=>B(),children:"Refresh"})]}),!h&&(0,t.jsx)("p",{children:"Geen data"}),h&&(0,t.jsxs)("div",{className:"grid md:grid-cols-3 gap-4 text-sm",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("h3",{className:"font-semibold mb-1",children:["Unmatched invoices (",h.unmatched_invoices.length,")"]}),(0,t.jsx)("div",{className:"max-h-48 overflow-auto border rounded p-2",children:h.unmatched_invoices.map((e,s)=>{var a;return(0,t.jsxs)("p",{children:[null===(a=e.date)||void 0===a?void 0:a.slice(0,10)," \xb7 ",e.partner," \xb7 €",e.amount]},s)})})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("h3",{className:"font-semibold mb-1",children:["Unmatched bank (",h.unmatched_bank.length,")"]}),(0,t.jsx)("div",{className:"max-h-48 overflow-auto border rounded p-2",children:h.unmatched_bank.map((e,s)=>{var a;return(0,t.jsxs)("p",{children:[null===(a=e.date)||void 0===a?void 0:a.slice(0,10)," \xb7 ",e.description||e.partner," \xb7 €",e.amount]},s)})})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("h3",{className:"font-semibold mb-1",children:["PSP / batch (",h.psp_batch.length,")"]}),(0,t.jsx)("div",{className:"max-h-48 overflow-auto border rounded p-2",children:h.psp_batch.map((e,s)=>{var a;return(0,t.jsxs)("p",{children:[null===(a=e.date)||void 0===a?void 0:a.slice(0,10)," \xb7 ",e.partner||e.memo," \xb7 €",e.amount]},s)})})]})]})]}),(0,t.jsxs)("section",{className:"bg-white rounded shadow p-6 space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("h2",{className:"text-xl font-semibold",children:"Journal & Board Pack"}),(0,t.jsxs)("div",{className:"flex gap-3",children:[(0,t.jsx)("button",{className:"px-4 py-2 border rounded",onClick:W,children:F?"Laden...":"Bekijk journal"}),(0,t.jsx)("a",{className:"px-4 py-2 bg-gray-900 text-white rounded",href:g,target:"_blank",rel:"noreferrer",children:"Download board pack"})]})]}),T.length>0&&(0,t.jsxs)("div",{className:"overflow-x-auto text-sm max-h-64 overflow-y-auto border rounded",children:[(0,t.jsxs)("table",{className:"w-full text-left",children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"py-2 px-2",children:"Date"}),(0,t.jsx)("th",{children:"Entity"}),(0,t.jsx)("th",{children:"Account"}),(0,t.jsx)("th",{children:"Debit"}),(0,t.jsx)("th",{children:"Credit"}),(0,t.jsx)("th",{children:"Ref"})]})}),(0,t.jsx)("tbody",{children:T.slice(0,80).map((e,s)=>{var a;return(0,t.jsxs)("tr",{children:[(0,t.jsx)("td",{className:"py-1 px-2",children:null===(a=e.date)||void 0===a?void 0:a.slice(0,10)}),(0,t.jsx)("td",{children:e.entity}),(0,t.jsx)("td",{children:e.account}),(0,t.jsx)("td",{children:e.debit}),(0,t.jsx)("td",{children:e.credit}),(0,t.jsx)("td",{children:e.ref})]},s)})})]}),T.length>80&&(0,t.jsx)("p",{className:"p-2 text-xs text-gray-500",children:"Toon eerste 80 regels — download board pack voor volledige set."})]})]})]})]})}}},function(e){e.O(0,[933,971,117,744],function(){return e(e.s=3026)}),_N_E=e.O()}]);